#!/bin/zsh

BASE_DIR=$(dirname $(cd $(dirname $0); pwd))

# Setup runcoms
for rcfile in ${BASE_DIR}/src/*; do
  # Neovim
  if [[ "$rcfile" =~ "nvim$" ]]; then
    [[ ! -d "${HOME}/.config" ]] && mkdir -p ~/.config
    ln -sfv "$rcfile" "${HOME}/.config/nvim"
  # SSH
  elif [[ "$rcfile" =~ "ssh$" ]]; then
    [[ ! -d ~/.ssh ]] && mkdir -p ~/.ssh && chmod 600 ~/.ssh
    ln -sfv "${rcfile}/config" "${HOME}"/.ssh/config
  # Others
  else
    ln -sfv "$rcfile" "${HOME}/.${rcfile:t}"
  fi
done


echo "--> setup dein vim plugin"
if [[ ! -d ~/.cache/dein/repos/github.com/Shougo/dein.vim ]]; then
  mkdir -p ~/.cache/dein/repos/github.com/Shougo/dein.vim
  git clone --depth=1 https://github.com/Shougo/dein.vim ~/.cache/dein/repos/github.com/Shougo/dein.vim 
else
  pushd ~/.cache/dein/repos/github.com/Shougo/dein.vim
  git pull
  popd
fi


echo "--> setup tmux"
if [[ ! -d ~/.tmux/plugins/tpm ]]; then
  git clone --depth=1 https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
else
  pushd ~/.tmux/plugins/tpm
  git pull
  popd
fi


echo "--> setup anyenv"
[[ ! -d ~/.anyenv ]] && git clone https://github.com/anyenv/anyenv ~/.anyenv
[[ ! -d ~/.config/anyenv/anyenv-install ]] && mkdir -p ~/.config/anyenv && git clone https://github.com/anyenv/anyenv-install.git ~/.config/anyenv/anyenv-install
[[ ! -d "$(anyenv root)/plugins" ]] && mkdir -p $(anyenv root)/plugins && git clone https://github.com/znz/anyenv-update.git $(anyenv root)/plugins/anyenv-update
if [[ ! -x "`which anyenv`" ]]; then
  export PATH="$HOME/.anyenv/bin:$PATH"
  eval "$(anyenv init -)"
fi
yes N | anyenv install rbenv
yes N | anyenv install pyenv
yes N | anyenv install nodenv

anyenv update
VER_NODE="$(nodenv install -l | grep '^16.' | tail -1)"

echo $VER_NODE

